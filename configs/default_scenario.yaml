# default_scenario.yaml - PRODUCTION CONFIGURATION
# Stable, tested configuration for FR1 & FR2 validation

# Grid configuration
grid:
  width: 200                    # Back to tested size
  height: 200
  cell_size_m: 5.0              # 500m × 500m coverage
  obstacle_source: "nairobi"   # OSM data loader
  origin: "top_left"

# Time configuration
time:
  delta_t: 1.0
  max_steps: 200

# Agent configuration
agents:
  protesters:
    count: 400   # Scale with area (4× grid = 4× agents)
    # Maintains 0.0004 people/m² (still sparse but computationally feasible)
    
    spawn:
      type: "clusters"
      centers: "auto"   # Auto-generate from road intersections
      radius: 12
    
    # Heterogeneous agent types (3 profiles)
    types:
      cautious:
        ratio: 0.20             # 20% cautious
        speed_m_s: 1.0          # Slower
        risk_tolerance: 0.1     # Very risk-averse
        panic_threshold: 0.3
        clustering_affinity: 0.8
      average:
        ratio: 0.55              # 55% average
        speed_m_s: 1.2          # Normal speed
        risk_tolerance: 0.35     # Moderate risk
        panic_threshold: 0.5
        clustering_affinity: 0.5
      bold:
        ratio: 0.20              # 20% bold
        speed_m_s: 1.5          # Faster
        risk_tolerance: 0.65     # Risk-taking
        panic_threshold: 0.7
        clustering_affinity: 0.2
      vulnerable:
        ratio: 0.05               # 5% vulnerable
        speed_m_s: 0.7           # Slower
        risk_tolerance: 0.05      # Risk-averse
        panic_threshold: 0.2
        clustering_affinity: 0.9
    
    goals:
      strategy: "dynamic_weighted"
      T_MIN_SAFE: 300  # 5 minutes in safe zone before exit-seeking
      #exit_nodes: "auto"  # Populated by env.reset()
  
  police:
    count: 25  # Scale police (1:16 ratio)
    spawn:
      type: "strategic_grid"  # NEW: Cover area systematically
      # Grid patrol points covering 1km²
      positions:
        # Western corridor (Uhuru Highway intercept)
        - [20, 50]
        - [20, 100]
        - [20, 150]
        # Central CBD spine
        - [60, 40]
        - [60, 100]
        - [60, 160]
        # Eastern boundary
        - [100, 50]
        - [100, 100]
        - [100, 150]
        # Southern intercepts
        - [40, 180]
        - [80, 180]
        - [120, 180]
        # Northern intercepts
        - [40, 20]
        - [80, 20]
        - [120, 20]
        # Mobile reserves (central)
        - [100, 100]
        - [110, 100]
        - [90, 100]
        # Parliament/Harambee Ave cluster
        - [70, 70]
        - [80, 70]
        - [90, 70]
        # KICC area control
        - [100, 80]
        - [110, 80]
        - [120, 80]
    speed_m_s: 2.0
    deploy_prob: 0.03    # INCREASED from 0.01 (5% vs 1%)
    deploy_cooldown: 40

# Hazards configuration
hazards:
  gas:
    # Physical diffusion (m^2/s)
    diffusion_coeff: 0.4        # Urban turbulent dispersion
    # Decay parameters
    decay_rate: 0.015             # per second or per time-step (1%)
    # Emission parameters
    inj_intensity: 60.0          # mg/m^3 at source (peak)
    emission_duration: 40       # Seconds per canister
    # Wind parameters
    wind_direction: [0, 1]     # South wind (normalized later)
    wind_speed_m_s: 3.0        # 2 m/s (light breeze)
    # Harm model: H(c,t) = k * c * delta_t
    k_harm: 0.012               # (mg*s/m^3)^-1 -> yields H = 5.0 after 60s at 10 mg/m^3; will try k_harm: 0.15
    H_crit: 4.0                 # dimensionless threshold for incapacitation 
    # Concentration clipping (for numerical stability)
    concentration_min: 0.0
    concentration_max: 100.0

  water_cannon:
    enabled: true
    prob: 0.02
    strength_m: 5.0
    radius: 6
    stun_prob: 0.15
    cooldown: 30

  shooting:
    enabled: true
    prob_per_step: 0.0005    # 0.5% chance per police per step to attempt shoot
    lethality: 0.3            # 30% of shots cause incapacitation (not all fatal)
    max_targets_per_event: 1
    cooldown: 100              # Prevent rapid-fire


# Simulation
simulation:
  base_seed: 123456
  n_cell_max: 6
  store_full_traces: false
  termination_conditions:
    comment: "Episode ends when all protesters escaped or incapacitated"

# Monte Carlo (SAFE PARALLELIZATION)
monte_carlo:
  n_rollouts: 200               # Production target
  bootstrap_samples: 1000       # Full bootstrap
  n_jobs: 4                     # Parallelization
  
  n_rollouts_dev: 50            # Development
  bootstrap_samples_dev: 200
  
  use_memmap: false             # Small enough for RAM
  aggregate_on_the_fly: true

# Output
output:
  save_events: true
  save_I_grids: true
  save_path: "artifacts/rollouts/"
  save_visualizations: true